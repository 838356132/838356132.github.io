#!title:    博客运营记录
#!date:     2019-03-16
#!authors:  Mikukonai
#!cover:    
#!type:     原创
#!tags:     

#!content

# V4.0更新记录

2019年10月，对 Project Aurora 做了彻底的重构。10月23日，发布第4.0版本。以下是更新记录。

## 功能更新

功能更新主要有两个大方面：

+ 为“灵感”页增加了侧栏目录，方便快速定位到某个灵感。增加了标签索引，可以根据灵感中标注的标签，建立倒排索引，使用标签对灵感进行归类。
+ 增加个人Wiki功能，也就是“百科”栏目。原有的“书签”栏目作为单独的Wiki文章。

## 视觉更新

继续沿用 Material Design 风格的设计。更换了封面图片，优化了个别样式。

## 技术更新

- 使用TypeScript彻底重构了 Mikumark Markdown 解析器，同时修改了 Markdown 文章模板的格式。
- 博客彻底重构为SPA（单页应用），全站目前仅有1个HTML页面。
- 文章URL优化：`https://mikukonai.com/#/blog/博客文章标题`

------

# 使用TravisCI自动生成RSS

2019-02-20

为了实现RSS自动更新，使用 Travis CI 持续集成工具，在新内容被推送至远端仓库的同时，触发自动构建脚本，生成新的RSS并自动提交到远端仓库。

所谓的持续集成（CI），是敏捷开发的一个概念，指的是在开发过程中不断将新产出的代码集成到主干分支上。但是，频繁的集成，势必需要高度自动化的测试和构建工具，才能保证持续集成到主干的代码不出现质量问题。Travis CI便是这样一个工具，它与GitHub无缝对接，对开源项目免费，支持多种语言（开发的项目），提供了自动化测试和构建的服务。

利用Travis CI提供的便利，可以实现RSS的自动更新。这篇文章简要记录了Travis CI的配置过程。

## 配置步骤

**第一步**：使用GitHub账号，注册Travis CI账号。

**第二步**：编辑根目录下配置文件`.travis.yml`，内容如下：

```
language: generic
dist: xenial

branches:
  only:
    - master

before_install:
  - sudo apt-get install git
  - chmod +x ./CI/push.sh

script:
  - node ./CI/build.js $TRAVIS_COMMIT_MESSAGE

after_success:
  - ./CI/push.sh
```

解释一下。

- language指的是CI支持的语言，这里generic指的是支持所有可支持的语言，参见[文档](https://docs.travis-ci.com/user/languages/minimal-and-generic/)。
- dist指的是虚拟机运行的环境，xenial即Ubuntu 16.04LTS。这里需要解释一下，每次提交触发自动构建时，CI系统都会创建一个虚机环境，在此环境中运行构建流程。
- branches指的是参与CI的分支，这里只有一个master分支。
- before_install指的是安装依赖之前所执行的动作。根据[文档](https://docs.travis-ci.com/user/job-lifecycle/)所述，一个CI任务的生命周期包括install（安装依赖）和script（执行构建脚本）两大流程。上述配置文件中，before_install有两个动作，一是安装git，二是给已有的脚本加上可执行权限，免得执行时报权限错误。
- script是构建的主体流程。这里执行`build.js`脚本，其功能是根据文章目录和“灵感”内容生成RSS文档，并输出到虚机的文件系统中。script各条指令均返回0，即执行成功，意味着构建成功。否则为构建失败。
- after_success是构建成功后需要走的流程。刚才的构建流程只是把生成的RSS保存在虚机文件系统中，并没有推送到远端仓库。因此，在这一步中，执行`push.sh`脚本，将生成的RSS推送到远端仓库。

**第三步**：添加`build.js`和`push.sh`脚本，脚本内容这里不详述。唯一需要注意的是对于GitHub令牌的处理。在`push.sh`中，需要使用GitHub令牌执行推送动作，但是这个令牌应当是保密的，因此不可以直接写在配置文件或者脚本中。解决方案是：

+ 在GitHub的设置-开发者选项-Personal access tokens中新建一个令牌，权限只提供仓库访问权限即可。然后点击“生成”，将生成的令牌复制出来并保存，注意这个令牌只在刚刚生成之后可以显示，以后就看不到了。
+ 在Travis的仓库设置中，增加一个环境变量，名字为`GITHUB_TOKEN`（总之就是脚本中使用的），值为刚才生成的Token。

通过这种途径保存的环境变量，是加密的环境变量。

**第四步**：在Travis中，打开对应仓库的CI功能。此时，每次推送，都会触发CI的自动构建过程。

## 参考资料

+ [Travis CI Doc](https://docs.travis-ci.com/)
+ [持续集成服务 Travis CI 教程](http://www.ruanyifeng.com/blog/2017/12/travis_ci_tutorial.html)

------

# 独立博客的价值

2019-02-18

> 本文为知乎回答。原问题：[国内搞独立域名个人博客并更新的还有多少人？有前途吗？](https://www.zhihu.com/question/19990156)

感觉绝对数量不少，但是因为其本身有一定门槛且传播方式局限，相比于寄生于各大平台的博客和自媒体，数量大概是可以忽略不计的。独立博客之间通过blogroll（友情链接）的方式建立连接，读者和博主之间采取松散的方式（例如RSS、评论、读者主动访问）建立联系，这很容易形成封闭的小圈子，然而交流强度又远远不够，最终还是要引流到SNS才能达成有效沟通。

博客的精神核心是开放、分享、交流。独立博客是开放互联网的一部分，内容可以被全文搜索引擎爬取收录，从而成为开放知识的一部分。因此，在如今【平台圈地自萌—巨头闭关自守—创作者寄生于平台—内容创作去中心化—非语义化内容（图片、短视频等）增加—变现方式丰富】的大背景下，仅凭借独立博客这种中心化的传播方式搞大新闻，是很艰难的。多数博主在缺乏正反馈的情况下，很难坚持做好独立博客。

因此，独立博客在今天，注定是小众的、内向的。独立博客式微，某种程度上也反映出“万维网已死”的现状。

但独立博客并非没有价值，许多答主已经总结得非常全面了。总体来说，独立博客的价值在于：

- 开放、自由，博主对博客有绝对的掌控力，甚至可以规避内容审查
- 小圈子、亚文化、同好团体的抱团取暖
- 由于建站本身有一定技术门槛，因此独立博客的内容质量要较好一些
- 博客是比较重量级的个人知识管理工具，适合承载有深度的、系统性的、大规模的内容
- 介于私有收藏和大众传播之间的一道缓冲带
- 闷声发大财地在互联网上建立自己的品牌和精神空间

GitHub目前看来可能是最适合作为博客平台的平台。作为真·独立博客和寄生于平台的自媒体的折中，它的优势如下：

- Git本身是代码管理工具，天然地适合处理语义化数据（文本）
- Git是面向社会化开发设计的，~Git♂Hub号称全球最大的同性交友平台~
- Git是分布式的，使用得当的话不需要担心数据丢失的问题
- Git可以追踪版本记录，这非常有利于长期填坑

但GitHub是有劣势的，例如

- 它终究是寄生于GitHub这个平台，内容不能被一般的搜索引擎抓取
- 维护门槛较高，受众面太窄，内容难以传播、变现

**对于仍然怀有共享精神的创作者来说，我的建议是，无论内容传播模式如何发展，独立博客永远是创作者的温暖港湾。无论如何，维护一个只属于自己的精神家园，都是有益且必要的。**

延伸阅读：[Web 的未来，语义互联已死，请拥抱自由编辑](https://forum.learnsolid.cn/topic/88/web-%E7%9A%84%E6%9C%AA%E6%9D%A5-%E8%AF%AD%E4%B9%89%E4%BA%92%E8%81%94%E5%B7%B2%E6%AD%BB-%E8%AF%B7%E6%8B%A5%E6%8A%B1%E8%87%AA%E7%94%B1%E7%BC%96%E8%BE%91)


# V3.1更新记录

2019-01-10

## V3.1 文章Markdown模板

```
\#!metadata
{
    "title":"<文章标题>",
    "titleImage":"<题图路径>",
    "type":"[原创|转载|翻译]",
    "date":"<文章创建日期>",
    "author":[<文章作者>],
    "tags":[<文章标签>]
}

\#!content

<正文>

\#!css

#css:<引用的CSS文件路径>

<CSS代码>

\#!js

#script:<引用的脚本文件路径>

<JS代码>
```

注意事项：

- 元数据必须严格按照JSON的规范写，例如用双引号不用单引号、JSON内部不能出现注释，等等。因为解释器是通过调用`JSON.parse`来解析JSON的。
- 图片、CSS、JS等外部资源的相对路径均以网站根目录为基准目录。
- 外部引用的JS脚本，会被插入网页的`&lt;head&gt;`标签下，而直接写在文档中的JS脚本，会被插入到`&lt;body&gt;`标签的最后一个子元素位置。
- 斜体样式标记改为`\%\%...\%\%`。

V3.1重构要点如下：

- 文章页模板与Markdown文档彻底分离，同时保留了对文档内嵌JavaScript和CSS代码的支持。
- 理顺了文章页CSS样式类的关系。
- 将MikuMark.js模块化。
- 增加了伪加载动效。
- 通过前端路由，实现quasi-SPA的特性。

关于前端路由，经过权衡，目前采用文章模板页解析请求参数的方式。尽管该方案势必会影响SEO，但本站并不是很在乎SEO，因此选用这个简单的方案。

作为技术储备，[这个方案](http://www.backalleycoder.com/2016/05/13/sghpa-the-single-page-app-hack-for-github-pages/)通过 Hack GitHub 提供的404页面，可以实现更优雅的前端路由。但是对SEO仍然有一定的影响。

## MikuMark.js 重构说明

本次重构，没有改变MikuMark.js的实现算法，仅完善了代码结构上一些不合理之处。

### 文档结构

源文档分为三大部分：

+ 元数据（#!metadata）
+ 引用和内联的CSS和JS代码（#!css和#!js）
+ Markdown内容（#!content）

其中，Markdown字段是文档的主体内容。

Markdown 文档的基本组成部分是元素。元素分为**段落级元素**和**跨段落元素**两种。

文档由连续换行划分为自然段，自然段可能是一个完整的段落级元素（例如图片、文字段落、表格等），也有可能是跨段落元素的一部分（例如引用框中的一个段落、代码区域内部的一个段落）。像这种由多个自然段组成的段落，称为逻辑段落，对应的元素为跨段落元素。

### 跨段落元素

+ 代码：因代码中存在连续换行，因此位于代码元素范围内的连续换行，不能被解释为段落分隔符。
+ 引用框：被引用的可以是任何段落级元素，以及引用框本身。引用引用框本身，即为引用框的嵌套。由于一个引用框内部可以引用多个段落级元素。在解析过程中，相邻的若干个引用框元素，会被合并为一整个大的引用框，而不是相互独立的引用框。

### 段落级元素

+ 文字段落（有换行的）
+ 标题
+ 居中段落（居中的文字段落）
+ 图片（其中标题是无换行文字段落）
+ 表格（每个单元格都是无换行文字段落）
+ 列表（分为有序和无序两种，每个item都是无换行文字段落）
+ 水平线
+ 音乐
+ 整行公式
+ HTML代码

注意：文字段落分为“无换行的文字段落”和“无换行的文字段落”，它是段落级元素的基础，因为它具有段内样式（见下文）。在无换行文字段落中实现换行，需要手写&lt;br&gt;标签。

### 段内样式

段内样式的适用范围是：文字段落、居中段落、图片的标题、表格、列表。

+ 行内代码
+ 颜色
+ 粗体
+ 斜体
+ 删除线
+ 超链接

为了避免粗体和斜体这两种样式混用可能导致的二义性问题，**斜体的语法修改为`\%\%...\%\%`**，粗体的语法保持不变。

### 对转义字符的处理

元字符需要手动转义，方法是在元字符前面加反斜杠。在解析前，转义的元字符会被换成占位符，保护起来，最终输出文档树时，再换回原来的符号。

在代码块或者正文中混用HTML，可能有多种结果。这个需要更细致的考虑。

### 其他特性或问题

+ 由于浏览器会智能地处理某些标签不匹配的错误，因此 Mikumark 不提供格式检查功能。
+ 列表在逻辑上应当属于某一段落内部的成分，但是为了保持 Markdown 的简洁性，对此不作考虑。
+ 原计划提供通过CSS自由修改段内样式的格式，基于与前一条相同的考虑，也不作考虑。
+ 目录树的生成仍然有潜在的问题，待进一步优化。
+ 代码高亮属于重要不紧急需求，暂时先不做扩展。

------

# 博客个人域名

2018-10-28

## 引言

域名是一种无形资产，好的域名代表着信誉和专业。当然，在移动互联网时代，域名的价值已经有所削弱，但作为一种资源，仍然具有特殊的价值。

一直以来，Project Aurora 托管在 GitHub Page、Coding Page 等多处，没有属于自己的域名。这次购买一个.com域名，正好可以用在静态博客上。

com顶级域名含金量最高，但也意味着好名字很难抢到。cn顶级域名据说非常坑。其他顶级域名诸如me、top、cc等，可能会影响搜索引擎收录。因此综合考虑，选择了com域名。

## 购买域名和解析服务

这次选择阿里云。首先选择域名，并添加实名认证信息。未实名认证的域名，购买后会处于serverhold状态，无法解析，只有通过实名认证，才能正常使用。晚上8点多提交实名认证资料，第二天凌晨三点即通过实名认证。

域名费用优惠后50元左右。

只有域名是不能使用的，必须购买DNS解析服务。这里选择的是一年18元的云解析服务。

## 解析配置

目标是将新买的域名 mikukonai.com 解析到 mikukonai.github.io。这里需要做两件事情：

+ 在阿里云的云解析配置中，增加CNAME配置：@.mikukonai.com，解析到 mikukonai.github.io。其中“@”符号代表空的二级域名。套餐最低TTL为10分钟。
+ 在GitHub的站点根目录下增加一个文件，文件名为“CNAME”，内容只有一行，写 mikukonai.com。

设置就绪后，等一段时间（至少要过一次TTL时间），即可正常解析。

## 后记

CNAME记录和A记录都可以指定域名解析规则，区别在于CNAME记录是将域名解析到其他域名，而A记录是将域名解析到IP地址。本次设置的目的是将 mikukonai.com 映射到 GitHub 提供的 mikukonai.github.io，因此云解析服务侧需要配置CNAME记录；同时 GitHub 侧也需要配置CNAME记录，用于将 mikukonai.github.io 重定向到 mikukonai.com，然后通过云解析服务解析到 mikukonai.github.io 所在的服务器。这一过程并不会形成死循环，猜想 GitHub 侧的CNAME记录并不是真正的CNAME记录。详细的原因还不清楚，需要继续学习。


#!style

#!script
